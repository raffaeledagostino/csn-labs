---
title: "csn_lab06"
output: html_document
date: "2025-12-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Community detection

```{r}
library(igraph)
library(igraphdata) 
library(clustAnalytics)
source('utils.r')
library("xtable")

```

Karate graph

```{r}

data(karate,package="igraphdata")
upgrade_graph(karate)
```

Barabasi-Albert graph

```{r}

B <- matrix(0.1, nrow = 4, ncol = 4)  # between-block preference
diag(B) <- 1                          # within-block preference
G <- barabasi_albert_blocks(m=4, p=c(0.25, 0.25, 0.25, 0.25), B=B, t_max=200, type="Hajek", sample_with_replacement = FALSE)

vertex_attr_names(G)

```

Enron graph

```{r}

data(enron,package="igraphdata")
upgrade_graph(enron)

E(enron)$weight <- 1  
enron_undir <- as.undirected(enron, mode = "collapse", edge.attr.comb = list(weight="sum"))

enron_simple <- simplify(
  enron_undir,
  remove.multiple = TRUE,
  remove.loops = TRUE,
  edge.attr.comb = list(weight="sum")
)

# Verify
is_directed(enron_simple)  # should be FALSE
is_simple(enron_simple)    # should be TRUE
#E(enron_simple)$weight     # should show edge weights (counts)

```

Immuno graph

```{r}
data("immuno" ,package="igraphdata")
upgrade_graph(immuno)

is_directed(immuno)  # should be FALSE
is_simple(immuno)    # should be TRUE
```

Evaluating significance of different clustering algorithms

```{r}

set.seed(0)

# ========== KARATE ==========
cat("Running Karate (10 runs)...\n")
karate_results <- evaluate_multiple_runs(
  karate,
  alg_list = list(
    Louvain     = cluster_louvain,
    labelprop   = cluster_label_prop,
    walktrap    = cluster_walktrap,
    betweenness = cluster_edge_betweenness
  ),
  gt_clustering = V(karate)$Faction,
  n_runs = 10
)

cat("\nKarate - Mean values:\n")
print(round(karate_results$mean, 3))
cat("\nKarate - Standard deviation:\n")
print(round(karate_results$sd, 3))


# ========== BA ==========
cat("\n\nRunning BA (10 runs)...\n")
BA_results <- evaluate_multiple_runs(
  G,
  alg_list = list(
    Louvain     = cluster_louvain,
    labelprop   = cluster_label_prop,
    walktrap    = cluster_walktrap,
    betweenness = cluster_edge_betweenness
  ),
  gt_clustering = V(G)$label,
  n_runs = 10
)

cat("\nBA - Mean values:\n")
print(round(BA_results$mean, 3))
cat("\nBA - Standard deviation:\n")
print(round(BA_results$sd, 3))


# ========== ENRON ==========
cat("\n\nRunning ENRON (10 runs)...\n")
enron_results <- evaluate_multiple_runs(
  enron_simple,
  alg_list = list(
    Louvain     = cluster_louvain,
    labelprop   = cluster_label_prop,
    walktrap    = cluster_walktrap,
    betweenness = cluster_edge_betweenness
  ),
  gt_clustering = NULL,
  n_runs = 10
)

cat("\nENRON - Mean values:\n")
print(round(enron_results$mean, 3))
cat("\nENRON - Standard deviation:\n")
print(round(enron_results$sd, 3))


# ========== IMMUNO ==========
cat("\n\nRunning Immuno (10 runs)...\n")
immuno_results <- evaluate_multiple_runs(
  immuno,
  alg_list = list(
    Louvain     = cluster_louvain,
    labelprop   = cluster_label_prop,
    walktrap    = cluster_walktrap,
    betweenness = cluster_edge_betweenness
  ),
  gt_clustering = NULL,
  n_runs = 10
)

cat("\nImmuno - Mean values:\n")
print(round(immuno_results$mean, 3))
cat("\nImmuno - Standard deviation:\n")
print(round(immuno_results$sd, 3))


```

```{r}

# 1. clustering coefficient (high is best)
# 2. expansion (low is best) 
# 3. conductance (low is best)
# 4. modularity (high is best)

# Create summary tables
summary_karate <- create_summary_table(karate_results, "Karate")
summary_BA <- create_summary_table(BA_results, "Barabási-Albert")
summary_enron <- create_summary_table(enron_results, "ENRON")
summary_immuno <- create_summary_table(immuno_results, "Immuno")

```

Computing clusters

```{r}
# ========== KARATE ==========
karate_louvain    <- cluster_louvain(karate)
karate_labelprop  <- cluster_label_prop(karate)
karate_walktrap   <- cluster_walktrap(karate)
karate_edge_betweenness   <- cluster_edge_betweenness(karate)


# Ground truth
memb_karate_GT <- V(karate)$Faction


# ========== BARABÁSI-ALBERT ==========
BA_louvain    <- cluster_louvain(G)
BA_labelprop  <- cluster_label_prop(G)
BA_walktrap   <- cluster_walktrap(G)
BA_edge_betweenness   <- cluster_edge_betweenness(G)


memb_BA_GT <- V(G)$label  # ground truth


# ========== ENRON ==========
enron_louvain    <- cluster_louvain(enron_simple)
enron_labelprop  <- cluster_label_prop(enron_simple)
enron_walktrap   <- cluster_walktrap(enron_simple)
enron_edge_betweenness   <- cluster_edge_betweenness(enron_simple)


# ========== IMMUNO ==========
immuno_louvain    <- cluster_louvain(immuno)
immuno_labelprop  <- cluster_label_prop(immuno)
immuno_walktrap   <- cluster_walktrap(immuno)
immuno_edge_betweenness   <- cluster_edge_betweenness(immuno)


```

Karate Match Tables

```{r}
# ========== GROUND TRUTH vs LOUVAIN ==========
JS_GT_Louvain_kar <- jaccard_table(memb_karate_GT, karate_louvain$membership)
print("Ground Truth vs Louvain - Jaccard Table:")
print(round(JS_GT_Louvain_kar, 2))

MC_GT_Louvain_kar <- match_clusters(JS_GT_Louvain_kar, name1 = "GT", name2 = "Louvain")
print("Best Matches:")
print(MC_GT_Louvain_kar)
cat("\n")


# ========== GROUND TRUTH vs LABEL PROPAGATION ==========
JS_GT_LabelProp_kar <- jaccard_table(memb_karate_GT, karate_labelprop$membership)
print("Ground Truth vs Label Propagation - Jaccard Table:")
print(round(JS_GT_LabelProp_kar, 2))

MC_GT_LabelProp_kar <- match_clusters(JS_GT_LabelProp_kar, name1 = "GT", name2 = "LabelProp")
print("Best Matches:")
print(MC_GT_LabelProp_kar)
cat("\n")


# ========== GROUND TRUTH vs WALKTRAP ==========
JS_GT_Walktrap_kar <- jaccard_table(memb_karate_GT, karate_walktrap$membership)
print("Ground Truth vs Walktrap - Jaccard Table:")
print(round(JS_GT_Walktrap_kar, 2))

MC_GT_Walktrap_kar <- match_clusters(JS_GT_Walktrap_kar, name1 = "GT", name2 = "Walktrap")
print("Best Matches:")
print(MC_GT_Walktrap_kar)
cat("\n")


# ========== GROUND TRUTH vs EDGE BETWEENNESS ==========
JS_GT_EdgeBetw_kar <- jaccard_table(memb_karate_GT, karate_edge_betweenness$membership)
print("Ground Truth vs Edge Betweenness - Jaccard Table:")
print(round(JS_GT_EdgeBetw_kar, 2))

MC_GT_EdgeBetw_kar <- match_clusters(JS_GT_EdgeBetw_kar, name1 = "GT", name2 = "EdgeBetw")
print("Best Matches:")
print(MC_GT_EdgeBetw_kar)
cat("\n")

```

BA match tabels

```{r}
# ========== GROUND TRUTH vs LOUVAIN ==========
JS_GT_Louvain_BA <- jaccard_table(memb_BA_GT, BA_louvain$membership)
print("Ground Truth vs Louvain - Jaccard Table:")
print(round(JS_GT_Louvain_BA, 2))

MC_GT_Louvain_BA <- match_clusters(JS_GT_Louvain_BA, name1 = "GT", name2 = "Louvain")
print("Best Matches:")
print(MC_GT_Louvain_BA)
cat("\n")


# ========== GROUND TRUTH vs LABEL PROPAGATION ==========
JS_GT_LabelProp_BA <- jaccard_table(memb_BA_GT, BA_labelprop$membership)
print("Ground Truth vs Label Propagation - Jaccard Table:")
print(round(JS_GT_LabelProp_BA, 2))

MC_GT_LabelProp_BA <- match_clusters(JS_GT_LabelProp_BA, name1 = "GT", name2 = "LabelProp")
print("Best Matches:")
print(MC_GT_LabelProp_BA)
cat("\n")


# ========== GROUND TRUTH vs WALKTRAP ==========
JS_GT_Walktrap_BA <- jaccard_table(memb_BA_GT, BA_walktrap$membership)
print("Ground Truth vs Walktrap - Jaccard Table:")
print(round(JS_GT_Walktrap_BA, 2))

MC_GT_Walktrap_BA <- match_clusters(JS_GT_Walktrap_BA, name1 = "GT", name2 = "Walktrap")
print("Best Matches:")
print(MC_GT_Walktrap_BA)
cat("\n")


# ========== GROUND TRUTH vs EDGE BETWEENNESS ==========
JS_GT_EdgeBetw_BA <- jaccard_table(memb_BA_GT, BA_edge_betweenness$membership)
print("Ground Truth vs Edge Betweenness - Jaccard Table:")
print(round(JS_GT_EdgeBetw_BA, 2))

MC_GT_EdgeBetw_BA <- match_clusters(JS_GT_EdgeBetw_BA, name1 = "GT", name2 = "EdgeBetw")
print("Best Matches:")
print(MC_GT_EdgeBetw_BA)
cat("\n")

```

Enron Match tables

```{r}

# ========== WALKTRAP vs LOUVAIN ==========
JS_Walktrap_Louvain_enron <- jaccard_table(enron_walktrap$membership, enron_louvain$membership)
print("Walktrap vs Louvain - Jaccard Table:")
print(round(JS_Walktrap_Louvain_enron, 2))  

MC_Walktrap_Louvain_enron <- match_clusters(JS_Walktrap_Louvain_enron, name1 = "Walktrap", name2 = "Louvain")
print("Best Matches:")
print(MC_Walktrap_Louvain_enron)
cat("\n")


# ========== WALKTRAP vs LABEL PROPAGATION ==========
JS_Walktrap_Labprop_enron <- jaccard_table(enron_walktrap$membership, enron_labelprop$membership)
print("Walktrap vs Label Propagation - Jaccard Table:")
print(round(JS_Walktrap_Labprop_enron, 2))

MC_Walktrap_Labprop_enron <- match_clusters(JS_Walktrap_Labprop_enron, name1 = "Walktrap", name2 = "LabelProp")
print("Best Matches:")
print(MC_Walktrap_Labprop_enron)
cat("\n")


# ========== WALKTRAP vs EDGE BETWEENNESS ==========
JS_Walktrap_EdgeBetw_enron <- jaccard_table(enron_walktrap$membership, enron_edge_betweenness$membership)
print("Walktrap vs Edge Betweenness - Jaccard Table:")
print(round(JS_Walktrap_EdgeBetw_enron, 2))

MC_Walktrap_EdgeBetw_enron <- match_clusters(JS_Walktrap_EdgeBetw_enron, name1 = "Walktrap", name2 = "EdgeBetw")  # Fixed: consistent naming
print("Best Matches:")
print(MC_Walktrap_EdgeBetw_enron)
cat("\n")

# Reference clustering (Walktrap as ground truth)
Memb_enron_GT <- membership(enron_walktrap)

```

```{r}
# ========== WALKTRAP vs LOUVAIN ==========
JS_Walktrap_Louvain_immuno <- jaccard_table(immuno_walktrap$membership, immuno_louvain$membership)
print("Walktrap vs Louvain - Jaccard Table:")
print(round(JS_Walktrap_Louvain_immuno, 2))

MC_Walktrap_Louvain_immuno <- match_clusters(JS_Walktrap_Louvain_immuno, name1 = "Walktrap", name2 = "Louvain")
print("Best Matches:")
print(MC_Walktrap_Louvain_immuno)
cat("\n")


# ========== WALKTRAP vs LABEL PROPAGATION ==========
JS_Walktrap_Labprop_immuno <- jaccard_table(immuno_walktrap$membership, immuno_labelprop$membership)
print("Walktrap vs Label Propagation - Jaccard Table:")
print(round(JS_Walktrap_Labprop_immuno, 2))

MC_Walktrap_Labprop_immuno <- match_clusters(JS_Walktrap_Labprop_immuno, name1 = "Walktrap", name2 = "LabelProp")
print("Best Matches:")
print(MC_Walktrap_Labprop_immuno)
cat("\n")


# ========== WALKTRAP vs EDGE BETWEENNESS ==========
JS_Walktrap_EdgeBetw_immuno <- jaccard_table(immuno_walktrap$membership, immuno_edge_betweenness$membership)
print("Walktrap vs Edge Betweenness - Jaccard Table:")
print(round(JS_Walktrap_EdgeBetw_immuno, 2))

MC_Walktrap_EdgeBetw_immuno <- match_clusters(JS_Walktrap_EdgeBetw_immuno, name1 = "Walktrap", name2 = "EdgeBetw")
print("Best Matches:")
print(MC_Walktrap_EdgeBetw_immuno)
cat("\n")

Memb_immuno_GT <- membership(immuno_walktrap)
```

Weighted average Jaccard index comparison

```{r}
#karate
Wmean(MC_GT_Louvain_kar, memb_karate_GT)
Wmean(MC_GT_LabelProp_kar, memb_karate_GT)
Wmean(MC_GT_Walktrap_kar, memb_karate_GT)
Wmean(MC_GT_EdgeBetw_kar, memb_karate_GT)
```

```{r}
#BA
Wmean(MC_GT_Louvain_BA, memb_BA_GT)
Wmean(MC_GT_LabelProp_BA, memb_BA_GT)
Wmean(MC_GT_Walktrap_BA, memb_BA_GT)
Wmean(MC_GT_EdgeBetw_BA, memb_BA_GT)

```

```{r}
#Enron
Wmean(MC_Walktrap_Louvain_enron, Memb_enron_GT)
Wmean(MC_Walktrap_Labprop_enron, Memb_enron_GT)
Wmean(MC_Walktrap_EdgeBetw_enron, Memb_enron_GT)

```

```{r}
#immuno
Wmean(MC_Walktrap_Louvain_immuno, Memb_immuno_GT)
Wmean(MC_Walktrap_Labprop_immuno, Memb_immuno_GT)
Wmean(MC_Walktrap_EdgeBetw_immuno, Memb_immuno_GT)
```

weighted minimum Jaccard index

```{r}
#karate
Wmin(MC_GT_Louvain_kar, memb_karate_GT)$weighted_min
Wmin(MC_GT_LabelProp_kar, memb_karate_GT)$weighted_min
Wmin(MC_GT_Walktrap_kar, memb_karate_GT)$weighted_min
Wmin(MC_GT_EdgeBetw_kar, memb_karate_GT)$weighted_min

```

```{r}
#BA
Wmin(MC_GT_Louvain_BA, memb_BA_GT)$weighted_min
Wmin(MC_GT_LabelProp_BA, memb_BA_GT)$weighted_min
Wmin(MC_GT_Walktrap_BA, memb_BA_GT)$weighted_min
Wmin(MC_GT_EdgeBetw_BA, memb_BA_GT)$weighted_min

```

```{r}
#enron
Wmin(MC_Walktrap_Louvain_enron, Memb_enron_GT)$weighted_min
Wmin(MC_Walktrap_Labprop_enron, Memb_enron_GT)$weighted_min
Wmin(MC_Walktrap_EdgeBetw_enron, Memb_enron_GT)$weighted_min

```

```{r}
#immuno
Wmin(MC_Walktrap_Louvain_immuno, Memb_immuno_GT)$weighted_min
Wmin(MC_Walktrap_Labprop_immuno, Memb_immuno_GT)$weighted_min
Wmin(MC_Walktrap_EdgeBetw_immuno, Memb_immuno_GT)$weighted_min
```

Armonic average Jaccard index

```{r}
Wharmonic(MC_GT_Louvain_kar, memb_karate_GT)
Wharmonic(MC_GT_LabelProp_kar, memb_karate_GT)
Wharmonic(MC_GT_Walktrap_kar, memb_karate_GT)
Wharmonic(MC_GT_EdgeBetw_kar, memb_karate_GT)
```

```{r}

Wharmonic(MC_GT_Louvain_BA, memb_BA_GT)
Wharmonic(MC_GT_LabelProp_BA, memb_BA_GT)
Wharmonic(MC_GT_Walktrap_BA, memb_BA_GT)
Wharmonic(MC_GT_EdgeBetw_BA, memb_BA_GT)
```

```{r}
Wharmonic(MC_Walktrap_Louvain_enron, Memb_enron_GT)
Wharmonic(MC_Walktrap_Labprop_enron, Memb_enron_GT)
Wharmonic(MC_Walktrap_EdgeBetw_enron, Memb_enron_GT)
```

```{r}
Wharmonic(MC_Walktrap_Louvain_immuno, Memb_immuno_GT)
Wharmonic(MC_Walktrap_Labprop_immuno, Memb_immuno_GT)
Wharmonic(MC_Walktrap_EdgeBetw_immuno, Memb_immuno_GT)
```
